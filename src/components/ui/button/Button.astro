---
import type { LoadingState } from "@/types/common";
import type { ButtonProps } from "./types";
import { twMerge } from "tailwind-merge";

interface Props extends ButtonProps, LoadingState {
  // Any additional button-specific props
}

const {
  variant = "solid",
  color = "primary",
  size = "md",
  disabled = false,
  type = "button",
  fullWidth = false,
  icon = false,
  loading = false,
  className,
  ...rest
} = Astro.props;

// Base styles
const baseStyles =
  "inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2";

// Size variations
const sizeStyles = {
  xs: "px-2.5 py-1.5 text-xs",
  sm: "px-3 py-2 text-sm leading-4",
  md: "px-4 py-2 text-sm",
  lg: "px-4 py-2 text-base",
  xl: "px-6 py-3 text-base",
};

// Variant and color combinations
const variantStyles = {
  solid: {
    primary:
      "bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-indigo-500",
    secondary: "bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",
    success: "bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",
    danger: "bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",
    warning:
      "bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500",
  },
  outline: {
    primary:
      "border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-50 focus:ring-indigo-500",
    secondary:
      "border-2 border-gray-600 text-gray-600 hover:bg-gray-50 focus:ring-gray-500",
    success:
      "border-2 border-green-600 text-green-600 hover:bg-green-50 focus:ring-green-500",
    danger:
      "border-2 border-red-600 text-red-600 hover:bg-red-50 focus:ring-red-500",
    warning:
      "border-2 border-yellow-600 text-yellow-600 hover:bg-yellow-50 focus:ring-yellow-500",
  },
  ghost: {
    primary: "text-indigo-600 hover:bg-indigo-50 focus:ring-indigo-500",
    secondary: "text-gray-600 hover:bg-gray-50 focus:ring-gray-500",
    success: "text-green-600 hover:bg-green-50 focus:ring-green-500",
    danger: "text-red-600 hover:bg-red-50 focus:ring-red-500",
    warning: "text-yellow-600 hover:bg-yellow-50 focus:ring-yellow-500",
  },
};

// State styles
const stateStyles = {
  disabled: "opacity-50 cursor-not-allowed",
  loading: "cursor-wait",
  fullWidth: "w-full",
};

const buttonStyles = twMerge(
  baseStyles,
  sizeStyles[size],
  variantStyles[variant][color],
  disabled && stateStyles.disabled,
  loading && stateStyles.loading,
  fullWidth && stateStyles.fullWidth,
  icon && "p-2",
  className
);
---

<button
  type={type}
  disabled={disabled || loading}
  class={buttonStyles}
  {...rest}
>
  {
    loading && (
      <svg
        class="animate-spin -ml-1 mr-3 h-5 w-5"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        />
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        />
      </svg>
    )
  }
  <slot />
</button>
